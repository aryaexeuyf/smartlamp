<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Smart PJU - AryaProject</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.7.1/firebase-app-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background: #020617; color: #f8fafc; overflow-x: hidden; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .digital-font { font-family: 'Orbitron', sans-serif; }
        .loader { border-top-color: #38bdf8; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .status-online { color: #4ade80; text-shadow: 0 0 10px rgba(74, 222, 128, 0.5); }
        .status-offline { color: #f87171; text-shadow: 0 0 10px rgba(248, 113, 113, 0.5); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 z-50 bg-[#020617] flex flex-col items-center justify-center transition-all duration-1000">
        <div class="w-24 h-24 border-8 border-slate-800 border-t-sky-500 rounded-full animate-spin mb-6"></div>
        <h1 class="text-2xl font-bold tracking-widest animate__animated animate__pulse animate__infinite">SMART LAMP OUTDOOR</h1>
        <p class="text-sky-400 mt-2">Project by AryaTeam</p>
    </div>

    <!-- Header -->
    <header class="w-full max-w-lg mt-8 mb-6 text-center animate__animated animate__fadeInDown">
        <h2 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-emerald-400">PJU CONTROL CENTER</h2>
        <div id="connStatus" class="mt-2 text-sm status-offline font-medium italic">Checking connection...</div>
    </header>

    <!-- Clock Section -->
    <div class="w-full max-w-lg glass rounded-3xl p-6 mb-6 text-center shadow-2xl animate__animated animate__fadeIn">
        <div id="time" class="digital-font text-5xl text-sky-400 mb-2">00:00:00</div>
        <div id="date" class="text-slate-400 text-sm tracking-widest uppercase">SENIN, 01 JANUARI 2024</div>
    </div>

    <!-- Main Control -->
    <main class="w-full max-w-lg space-y-4">
        <div class="glass rounded-3xl p-8 flex flex-col items-center justify-center relative overflow-hidden">
            <div id="lampIndicator" class="w-24 h-24 rounded-full bg-slate-800 flex items-center justify-center mb-6 transition-all duration-500 shadow-[0_0_20px_rgba(0,0,0,0.5)]">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
            </div>
            <button id="toggleBtn" onclick="toggleLamp()" class="bg-gradient-to-br from-sky-500 to-blue-700 hover:from-sky-400 hover:to-blue-600 text-white px-12 py-4 rounded-full font-bold shadow-lg transform active:scale-95 transition-all text-lg">
                TURN ON
            </button>
            <div class="mt-4 text-xs text-slate-500 italic">Tap to change lamp status</div>
        </div>

        <!-- Admin Section -->
        <div id="adminPanel" class="hidden animate__animated animate__fadeInUp">
            <div class="glass rounded-3xl p-6 space-y-4">
                <h3 class="font-bold border-b border-white/10 pb-2 flex justify-between">
                    <span>ADMIN SETTINGS</span>
                    <button onclick="logoutAdmin()" class="text-xs text-red-400">Logout</button>
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <button class="bg-slate-800 p-4 rounded-2xl text-xs">üìÖ JADWAL PJU</button>
                    <button class="bg-slate-800 p-4 rounded-2xl text-xs">üéµ BUZZER TONE</button>
                    <button class="bg-slate-800 p-4 rounded-2xl text-xs">‚ú® EFEK FLICKER</button>
                    <button class="bg-slate-800 p-4 rounded-2xl text-xs" onclick="resetSystem()">‚ö†Ô∏è RESET LAMP</button>
                </div>
                <!-- Light Detection Mockup -->
                <div class="bg-black/20 p-4 rounded-2xl mt-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs">Cam Light Detection</span>
                        <span id="lightVal" class="text-xs font-bold text-emerald-400">TERANG</span>
                    </div>
                    <div class="h-2 w-full bg-slate-700 rounded-full overflow-hidden">
                        <div id="lightBar" class="h-full bg-emerald-500 w-full transition-all"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="loginSection" class="text-center py-4">
            <button onclick="requestAdmin()" class="text-slate-500 text-sm hover:text-sky-400 transition">Admin Login</button>
        </div>
    </main>

    <footer class="mt-auto py-8 text-slate-600 text-xs">
        Project by <span class="text-slate-400">AryaProject</span> &copy; 2024
    </footer>

    <script>
        // FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyCfRXQKtfSQemzyESufRa-8MGNd_Pi2EeE",
            databaseURL: "https://lampu-pju-njati-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lampu-pju-njati"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let lampStatus = false;
        const ADMIN_PIN = "RCLED123";

        // DOM Elements
        const loading = document.getElementById('loading');
        const connStatus = document.getElementById('connStatus');
        const timeEl = document.getElementById('time');
        const dateEl = document.getElementById('date');
        const lampInd = document.getElementById('lampIndicator');
        const toggleBtn = document.getElementById('toggleBtn');

        // Loading Timeout
        setTimeout(() => {
            loading.style.opacity = '0';
            setTimeout(() => loading.style.display = 'none', 1000);
        }, 4000);

        // Realtime Clock
        function updateTime() {
            const now = new Date();
            timeEl.innerText = now.toTimeString().split(' ')[0];
            dateEl.innerText = now.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Firebase Sync
        const lampRef = db.ref('status/lampu');
        lampRef.on('value', (snapshot) => {
            lampStatus = snapshot.val();
            updateUI();
            connStatus.innerText = "Your device connected to internet";
            connStatus.className = "mt-2 text-sm status-online font-medium italic";
        }, (err) => {
            connStatus.innerText = "Your device not connected to internet";
            connStatus.className = "mt-2 text-sm status-offline font-medium italic";
        });

        function updateUI() {
            if (lampStatus) {
                lampInd.classList.remove('bg-slate-800');
                lampInd.classList.add('bg-yellow-400', 'shadow-[0_0_40px_rgba(250,204,21,0.6)]');
                toggleBtn.innerText = "TURN OFF";
                toggleBtn.classList.replace('from-sky-500', 'from-red-500');
            } else {
                lampInd.classList.add('bg-slate-800');
                lampInd.classList.remove('bg-yellow-400', 'shadow-[0_0_40px_rgba(250,204,21,0.6)]');
                toggleBtn.innerText = "TURN ON";
                toggleBtn.classList.replace('from-red-500', 'from-sky-500');
            }
        }

        function toggleLamp() {
            db.ref('status/lampu').set(!lampStatus);
        }

        // Admin Logic
        function requestAdmin() {
            const pin = prompt("Enter Admin PIN:");
            if (pin === ADMIN_PIN) {
                localStorage.setItem('pju_admin', 'true');
                showAdminPanel();
            } else {
                alert("Wrong PIN!");
            }
        }

        function showAdminPanel() {
            document.getElementById('adminPanel').classList.remove('hidden');
            document.getElementById('loginSection').classList.add('hidden');
        }

        function logoutAdmin() {
            localStorage.removeItem('pju_admin');
            location.reload();
        }

        // Auto Check Admin on Load
        if(localStorage.getItem('pju_admin')) showAdminPanel();

        // Camera Light Detection (Simplified Logic)
        async function startLightDetection() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                // Note: Logic deteksi pixel di sini biasanya menggunakan canvas
                // Karena batasan preview, kita tampilkan indikator simulasi berdasarkan sensor device jika ada
                console.log("Camera access granted for light detection");
            } catch (err) {
                console.log("Camera permission denied");
            }
        }
        startLightDetection();

        function resetSystem() {
            if(confirm("Hapus semua data EEPROM dan restart ESP?")) {
                db.ref('commands/reset').set(true);
                alert("Reset command sent.");
            }
        }
    </script>
</body>
</html>
